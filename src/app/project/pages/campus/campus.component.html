<p-toast key="campus"></p-toast>
<p-confirmDialog key="campus" [style]="{ width: '500px' }"></p-confirmDialog>
<p-confirmDialog key="campusUpdateByDeleted" [style]="{ width: '500px' }"></p-confirmDialog>

<div class="grid">
    <div class="col-12 sm:col-12 md:col-12 lg:col-12 xl:col-12">
        <app-card header="Mantenedor de campus" subheader="Permite ver, crear, actualizar y eliminar campus.">

            <app-menu-buttons-table (clickOpenNew)="openCreate()"
                (clickDeletededSelected)="openConfirmationDeleteSelectedCampus($event)"
                [selectedRows]="selectedRows"></app-menu-buttons-table>

            <app-table-campus [data]="campuses" [cols]="cols" [globalFiltros]="globalFiltros"
                [dataKeyTable]="dataKeyTable" [resetSelectedRowsEmitter]="resetSelectedRowsEmitter"
                (refreshTable)="getCampuses()" (actionMode)="actionMode($event)"
                (actionSelectRow)="actionSelectRow($event)">
            </app-table-campus>

            <app-dialog [(visible)]="dialog">

                <div header>
                    <ng-container [ngSwitch]="mode">

                        <ng-container *ngSwitchCase="'create'">
                            <span class="text-xl">Agregar campus</span>
                        </ng-container>

                        <ng-container *ngSwitchCase="'edit'">
                            <span class="text-xl">Actualizar campus</span>
                        </ng-container>

                        <ng-container *ngSwitchCase="'show'">
                            <span class="text-xl">Ver campus</span>
                        </ng-container>


                    </ng-container>
                </div>

                <div content>
                    <ng-container [ngSwitch]="mode">


                        <ng-container *ngSwitchCase="'show'">
                            <form>
                                <div class="grid">
                                    <div class="col-9 sm:col-9 md:col-9 lg:col-9 xl:col-9">
                                        <div class="field">
                                            <label for="Descripcion_campus">Nombre</label>
                                            <input id="Descripcion_campus" [disabled]="true" type="text" pInputText
                                                class="w-full" value="{{campus.Descripcion_campus}}" />
                                        </div>
                                    </div>
                                    <div class="col-3 sm:col-3 md:col-3 lg:col-3 xl:col-3">
                                        <div class="flex justify-content-center flex-wrap">
                                            <div class="flex align-items-center justify-content-center">
                                                <div class="field">
                                                    <label for="">Estado</label>
                                                    <br>
                                                    <ng-container *ngIf="campus.Estado_campus == 1">
                                                        <div class="mt-2">
                                                            <span class="estado-badge estado-activo">activo</span>
                                                        </div>
                                                    </ng-container>

                                                    <ng-container *ngIf="campus.Estado_campus == 0">
                                                        <div class="mt-2">
                                                            <span class="estado-badge estado-desactivo">desactivo</span>
                                                        </div>
                                                    </ng-container>

                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="grid">
                                    <div class="col-12 sm:col-12 md:col-12 lg:col-12 xl:col-12">
                                        <div class="field">
                                            <label>Archivos REXE (.pdf)</label>
                                            <p-table [value]="_files" [tableStyle]="{'min-width': '18.75rem'}">
                                                <ng-template pTemplate="header">
                                                    <tr>
                                                        <th>Nombre</th>
                                                        <th>Comentarios</th>
                                                        <th>Acci√≥n</th>
                                                    </tr>
                                                </ng-template>

                                                <ng-template pTemplate="body" let-file let-i="rowIndex">
                                                    <tr>
                                                        <td style="min-width: 15rem;">
                                                    <tr>
                                                        <td class="pr-3">
                                                            <img width="40"
                                                                src="https://repositorio.uv.cl/imagenes/extensions/{{file.nombre.toLowerCase() | fileExtension}}.png"
                                                                style="margin: 0 auto" />
                                                        </td>
                                                        <td style="word-break: break-all">
                                                            {{ file.nombre | lowercase | slice:0:15 }} {{
                                                            (file.nombre.length > 15 ) ? '... .pdf' : '' }}<br />
                                                            <em class="small" style="color: gray"><i
                                                                    class="pi pi-file"></i> {{ file.extras.pesoDocumento
                                                                | fileSize }}</em>
                                                        </td>
                                                    </tr>
                                                    </td>
                                                    <td>
                                                        <textarea rows="2" cols="15" pInputTextarea
                                                            [disabled]="true">{{file.extras.comentarios == '' ? 'N/A' : file.extras.comentarios}}</textarea>
                                                    </td>
                                                    <td>
                                                        <p-button styleClass="p-button-primary p-button-sm mr-2"
                                                            icon="pi pi-download" label="Descargar"
                                                            (click)="downloadDoc(file)">
                                                        </p-button>
                                                    </td>
                                                    </tr>
                                                </ng-template>

                                                <ng-template pTemplate="emptymessage">
                                                    <tr>
                                                        <td colspan="3">No se encontraron archivos.</td>
                                                    </tr>
                                                </ng-template>
                                            </p-table>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </ng-container>

                        <!-- mode create / edit  -->
                        <ng-container *ngSwitchDefault>
                            <div class="grid">
                                <div class="col-12 sm:col-12 md:col-12 lg:col-12 xl:col-12">
                                    <app-form-isvalid [valid]="fbForm.valid"></app-form-isvalid>
                                </div>
                            </div>
                            <form [formGroup]="fbForm">
                                <div class="grid">
                                    <div class="col-10 sm:col-10 md:col-10 lg:col-10 xl:col-10">
                                        <div class="field">
                                            <label>Nombre *</label>
                                            <input type="text" pInputText formControlName="Descripcion_campus"
                                                class="w-full" placeholder="Ingrese nombre de campus" autofocus />

                                            <app-form-control [control]="fbForm.controls['Descripcion_campus']"
                                                [validators]="['required']"></app-form-control>
                                        </div>
                                    </div>
                                    <div class="col-2 sm:col-2 md:col-2 lg:col-2 xl:col-2">
                                        <div class="flex justify-content-center flex-wrap">
                                            <div class="flex align-items-center justify-content-center">
                                                <div class="field">
                                                    <label for="Estado">Estado *</label>
                                                    <br>
                                                    <p-inputSwitch formControlName="Estado_campus" styleClass="mt-1"
                                                        (onChange)="changeEstadoCampus($event)" />

                                                    <app-form-control [control]="fbForm.controls['Estado_campus']"
                                                        [validators]="['required']"></app-form-control>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </form>
                            <div class="grid">
                                <div class="col-12 sm:col-12 md:col-12 lg:col-12 xl:col-12">
                                    <app-uploader-files [extrasDocs]="extrasDocs" [triggerUpload]="triggerUpload"
                                        [resetQueueUploaderEmitter]="resetQueueUploaderEmitter"
                                        [files]="fbForm.get('files')?.value" (filesChange)="filesChanged($event)"
                                        (deleteDoc)="openConfirmationDeleteDoc($event)"></app-uploader-files>

                                </div>
                            </div>
                        </ng-container>
                    </ng-container>

                </div>

                <div footer>
                    <p-button label="Cerrar" icon="pi pi-times" styleClass="p-button-sm p-button-secondary mr-2"
                        (click)="dialog = false" [text]="true"></p-button>

                    <p-button *ngIf="mode == 'create' || mode == 'edit' "
                        [label]="mode === 'edit' ? 'Actualizar' : 'Guardar'" icon="pi pi-check"
                        styleClass="mr-2 p-button-success p-button-sm" [disabled]="!fbForm.valid"
                        (click)="fbForm.valid && submit()"></p-button>
                </div>

            </app-dialog>


        </app-card>
    </div>
</div>